<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Attestation de Formation</title>

<style>
@page {
    size: A4;
    margin: 18mm 22mm 20mm 22mm;
}

body {
    font-family: "Times New Roman", serif;
    font-size: 14pt;
    line-height: 1.6;
    color: #000;
    margin: 0;
}

/* ===== HEADER ===== */
.header {
    display: flex;
    align-items: center;
    border-bottom: 2px solid #0a2a66;
    padding-bottom: 8px;
    margin-bottom: 20px;
}

.logo {
    width: 70px;
    height: 70px;
    margin-right: 15px;
}

.logo img {
    width: 70px;
    height: 70px;
    object-fit: contain;
}

.institution-name {
    font-size: 18pt;
    font-weight: bold;
    color: #0a2a66;
}

.institution-details {
    font-size: 11pt;
    line-height: 1.4;
}

/* ===== TITLE ===== */
.document-title {
    text-align: center;
    font-size: 20pt;
    font-weight: bold;
    text-decoration: underline;
    margin: 20px 0 15px 0;
}

.attestation-number {
    text-align: center;
    font-size: 11pt;
    margin-bottom: 25px;
}

/* ===== CONTENT ===== */
.content {
    text-align: justify;
}

.highlight {
    font-weight: bold;
}

.student-info {
    margin: 20px 0;
}

.student-name {
    font-size: 15pt;
    font-weight: bold;
}

ul {
    margin: 20px 0;
    padding-left: 25px;
}

li {
    margin-bottom: 10px;
}

/* ===== SIGNATURE ===== */
.signature-table {
    width: 100%;
    margin-top: 40px;
    font-size: 14pt;
}

.signature-right {
    text-align: right;
}

/* ===== FOOTER ===== */
.footer {
    position: fixed;
    bottom: 12mm;
    left: 22mm;
    right: 22mm;
    border-top: 1px solid #999;
    padding-top: 8px;
    font-size: 10.5pt;
    line-height: 1.4;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.footer-text {
    width: 75%;
    text-align: center;
}

.qr-container {
    width: 90px;
    height: 90px;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
    <div class="logo">
        <img src="https://raw.githubusercontent.com/tibari1980/n8n_logo_image/main/cfrp.png"
             alt="Logo CFRP">
    </div>
    <div>
        <div class="institution-name">ASSOCIATION VALENTIN HAÜY</div>
        <div class="institution-details">
            Centre de Formation et de Rééducation Professionnelle<br>
            Établissement et Services de Réadaptation Professionnelle<br>
            5 rue Duroc – 75007 Paris
        </div>
    </div>
</div>

<!-- TITLE -->
<div class="document-title">ATTESTATION DE FORMATION</div>
<div class="attestation-number">
    N° d’attestation : <strong>{{$json.numero_attestation}}</strong>
</div>

<!-- CONTENT -->
<div class="content">
    <p>
        Je soussigné, <span class="highlight">Laurent GRIMALDI</span>, Responsable pédagogique des
        Formations Tertiaires du Centre de Formation et de Rééducation Professionnelle
        de l'Association Valentin Haüy, certifie que :
    </p>

    <div class="student-info">
        <p class="student-name">
            <span id="civilite"></span> {{$json.nom}} {{$json.prenom}}
        </p>
        <p>
            Domicilié : <span class="highlight">{{$json.adresse}}</span>
        </p>
    </div>

    <p>
        est entré dans notre établissement pour y suivre les cours :
    </p>

    <ul>
        <li>de la section <span class="highlight">{{$json.formation}}</span></li>
        <li>du <span class="highlight">{{$json.date_debut}}</span> au <span class="highlight">{{$json.date_fin}}</span></li>
        <li>pour une durée totale de <span class="highlight">{{$json.duree}}</span></li>
    </ul>

    <p>
        Nos stagiaires sont rémunérés durant ces périodes de formation par l’ASP.
    </p>

    <table class="signature-table">
        <tr>
            <td>
                Fait à Paris, le <span class="highlight" id="dateJour"></span>
            </td>
            <td class="signature-right">
                Le Responsable de formation,<br><br>
                <span class="highlight">Laurent GRIMALDI</span>
            </td>
        </tr>
    </table>
</div>

<!-- FOOTER -->
<div class="footer">
    <div class="footer-text">
        <strong>Établissement et Services de Réadaptation Professionnelle</strong><br>
        5 rue Duroc – 75343 PARIS Cedex 07 • www.cfrp-avh.fr
    </div>
    <div class="qr-container" id="qr"></div>
</div>

<!-- SCRIPTS -->
<script>
/* DATE FR */
document.getElementById("dateJour").innerText =
    new Date().toLocaleDateString('fr-FR', { day:'numeric', month:'long', year:'numeric' });

/* CIVILITÉ */
const sex = "{{$json.sex}}".toLowerCase().trim();
document.getElementById("civilite").innerText = (sex === "femme") ? "Madame" : "Monsieur";

/* ===== QR CODE SVG (sans librairie) ===== */
const qrData = JSON.stringify({
    nom: "{{$json.nom}}",
    prenom: "{{$json.prenom}}",
    date_naissance: "{{$json.date_naissance}}",
    formation: "{{$json.formation}}"
});

function generateSimpleQR(text) {
    const size = 90;
    let svg = `<svg viewBox="0 0 ${size} ${size}" width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">`;
    svg += `<rect width="100%" height="100%" fill="white"/>`;

    let hash = 0;
    for (let i = 0; i < text.length; i++) {
        hash = text.charCodeAt(i) + ((hash << 5) - hash);
    }

    let cell = size / 15;
    for (let y = 0; y < 15; y++) {
        for (let x = 0; x < 15; x++) {
            if ((hash >> (x + y)) & 1) {
                svg += `<rect x="${x*cell}" y="${y*cell}" width="${cell}" height="${cell}" fill="black"/>`;
            }
        }
    }

    svg += `</svg>`;
    return svg;
}

document.getElementById("qr").innerHTML = generateSimpleQR(qrData);
</script>

</body>
</html>
